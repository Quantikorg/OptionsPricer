<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Black-Scholes (with Greeks) & American Bjerksund-Stensland Option Pricer</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; color: #333; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .form-group { margin-bottom: 15px; }
    .form-group label { font-weight: bold; display: block; margin-bottom: 5px; }
    input[type=number], select { padding: 8px; width: 100%; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; box-sizing: border-box; }
    select { background-color: #fff8c4; font-size: 1.1rem; }
    input[type=range] { width: 100%; margin-bottom: 5px; accent-color: grey; }
    .result { margin-top: 10px; font-weight: bold; white-space: pre-wrap; }
    canvas { margin-top: 20px; }
    .button-container { margin-top: 15px; text-align: right; }
    button { padding: 10px 20px; font-size: 1rem; border: none; border-radius: 5px; background-color: grey; color: white; cursor: pointer; }
    button:hover { background-color: darkgrey; }
</style>
</head>
<body>
<div class="container">
    <h2>Interactive Black-Scholes & American Option Pricer with Greeks</h2>

    <div class="form-group">
        <label>Exercise Style:</label>
        <select id="exercise">
            <option value="european">European</option>
            <option value="american">American (Bjerksund-Stensland)</option>
        </select>
    </div>

    <div class="form-group">
        <label>Option Type:</label>
        <select id="type">
            <option value="call">Call</option>
            <option value="put">Put</option>
        </select>
    </div>

    <div class="form-group">
        <label>Strike Price (K):</label>
        <input type="number" id="K" value="100">
    </div>

    <div class="form-group">
        <label>Dividend Yield (q): <span id="q_val">0.0</span></label>
        <input type="range" id="q" min="0" max="0.1" step="0.001" value="0">
    </div>

    <div class="form-group">
        <label>Risk-free Rate (r): <span id="r_val">0.05</span></label>
        <input type="range" id="r" min="-0.05" max="0.10" step="0.001" value="0.05">
    </div>

    <div class="form-group">
        <label>Stock Price (S): <span id="S_val">100</span></label>
        <input type="range" id="S" min="50" max="150" value="100">
    </div>

    <div class="form-group">
        <label>Volatility (σ): <span id="sigma_val">0.2</span></label>
        <input type="range" id="sigma" min="0.05" max="1" step="0.01" value="0.2">
    </div>

    <div class="form-group">
        <label>Time to Maturity (Years, T): <span id="T_val">1</span></label>
        <input type="range" id="T" min="0.01" max="3" step="0.01" value="1">
    </div>

    <div class="button-container">
        <button id="resetBtn">Reset</button>
    </div>

    <div class="result" id="result"></div>
    <canvas id="greeksChart"></canvas>
</div>

<script>
function erf(x){var sign=x>=0?1:-1;x=Math.abs(x);var a=0.254829592,b=-0.284496736,c=1.421413741,d=-1.453152027,e=1.061405429;var t=1.0/(1.0+0.3275911*x);var y=1.0-((((((e*t+d)*t+c)*t+b)*t+a)*t)*Math.exp(-x*x));return sign*y;}
function normCDF(x){return (1.0+erf(x/Math.sqrt(2)))/2.0;}
function blackScholesGreeks(S,K,T,r,q,sigma,type){
const d1=(Math.log(S/K)+(r-q+0.5*sigma*sigma)*T)/(sigma*Math.sqrt(T));
const d2=d1-sigma*Math.sqrt(T);
const Nd1=normCDF(d1),Nd2=normCDF(d2),Nmd1=normCDF(-d1),Nmd2=normCDF(-d2);
const pdf=Math.exp(-0.5*d1*d1)/Math.sqrt(2*Math.PI);
let price,delta,gamma,theta,vega,rho;
if(type==='call'){
price=S*Math.exp(-q*T)*Nd1-K*Math.exp(-r*T)*Nd2;
delta=Math.exp(-q*T)*Nd1;
theta=(-S*Math.exp(-q*T)*pdf*sigma/(2*Math.sqrt(T))-r*K*Math.exp(-r*T)*Nd2+q*S*Math.exp(-q*T)*Nd1)/365;
rho=(K*T*Math.exp(-r*T)*Nd2)/100;
}else{
price=K*Math.exp(-r*T)*Nmd2-S*Math.exp(-q*T)*Nmd1;
delta=Math.exp(-q*T)*(Nd1-1);
theta=(-S*Math.exp(-q*T)*pdf*sigma/(2*Math.sqrt(T))+r*K*Math.exp(-r*T)*Nmd2-q*S*Math.exp(-q*T)*Nmd1)/365;
rho=(-K*T*Math.exp(-r*T)*Nmd2)/100;
}
gamma=pdf*Math.exp(-q*T)/(S*sigma*Math.sqrt(T));
vega=S*Math.exp(-q*T)*pdf*Math.sqrt(T)/100;
return {price,delta,gamma,theta,vega,rho};
}
function bjerksundStensland(S,K,r,q,sigma,T,type){
if(type==='call')return blackScholesGreeks(S,K,T,r,q,sigma,type).price;
else{const european=blackScholesGreeks(S,K,T,r,q,sigma,type).price;return Math.max(european,K-S);}
}
let chart;
function updateStockSlicer(){
const K=parseFloat(document.getElementById('K').value);
const S_input=document.getElementById('S');
const currentValue=parseFloat(S_input.value);
S_input.min=(K*0.5).toFixed(2);
S_input.max=(K*1.5).toFixed(2);
if(currentValue<parseFloat(S_input.min)||currentValue>parseFloat(S_input.max)){
S_input.value=K.toFixed(2);
}
document.getElementById('S_val').innerText=parseFloat(S_input.value).toFixed(2);
}
function updateChart(){
const S=parseFloat(document.getElementById('S').value);
const K=parseFloat(document.getElementById('K').value);
const T=parseFloat(document.getElementById('T').value);
const r=parseFloat(document.getElementById('r').value);
const sigma=parseFloat(document.getElementById('sigma').value);
const q=parseFloat(document.getElementById('q').value);
const type=document.getElementById('type').value;
const exercise=document.getElementById('exercise').value;
document.getElementById('S_val').innerText=S.toFixed(2);
document.getElementById('T_val').innerText=T.toFixed(2);
document.getElementById('sigma_val').innerText=sigma.toFixed(2);
document.getElementById('r_val').innerText=r.toFixed(3);
document.getElementById('q_val').innerText=q.toFixed(3);
let price,greeks;
if(exercise==='european'){
greeks=blackScholesGreeks(S,K,T,r,q,sigma,type);
price=greeks.price;
}else{
price=bjerksundStensland(S,K,r,q,sigma,T,type);
greeks={delta:0,gamma:0,theta:0,vega:0,rho:0};
}
document.getElementById('result').innerText=`${type.charAt(0).toUpperCase()+type.slice(1)} Price: $${price.toFixed(2)}\nDelta: ${greeks.delta.toFixed(4)}, Gamma: ${greeks.gamma.toFixed(4)}, Theta: ${greeks.theta.toFixed(4)}, Vega: ${greeks.vega.toFixed(4)}, Rho: ${greeks.rho.toFixed(4)}`;
const pricesArray=[S*0.5,S*0.6,S*0.7,S*0.8,S*0.9,S,S*1.1,S*1.2,S*1.3,S*1.4,S*1.5].map(p=>parseFloat(p.toFixed(2)));
const deltas=[],gammas=[],thetas=[],vegas=[],rhos=[];
const idx=5;
pricesArray.forEach(sVal=>{
const g=exercise==='european'?blackScholesGreeks(sVal,K,T,r,q,sigma,type):{delta:0,gamma:0,theta:0,vega:0,rho:0};
deltas.push(g.delta);
gammas.push(g.gamma);
thetas.push(g.theta);
vegas.push(g.vega);
rhos.push(g.rho);
});
const ctx=document.getElementById('greeksChart').getContext('2d');
if(chart)chart.destroy();
chart=new Chart(ctx,{type:'line',data:{labels:pricesArray,datasets:[{label:'Delta',data:deltas,borderColor:'blue',fill:false,tension:0.2},{label:'Gamma',data:gammas,borderColor:'green',fill:false,tension:0.2},{label:'Theta',data:thetas,borderColor:'orange',fill:false,tension:0.2},{label:'Vega',data:vegas,borderColor:'purple',fill:false,tension:0.2},{label:'Rho',data:rhos,borderColor:'red',fill:false,tension:0.2},{label:'Delta Current',data:deltas.map((v,i)=>i===idx?v:null),borderColor:'blue',pointRadius:6,type:'scatter',showLine:false},{label:'Gamma Current',data:gammas.map((v,i)=>i===idx?v:null),borderColor:'green',pointRadius:6,type:'scatter',showLine:false},{label:'Theta Current',data:thetas.map((v,i)=>i===idx?v:null),borderColor:'orange',pointRadius:6,type:'scatter',showLine:false},{label:'Vega Current',data:vegas.map((v,i)=>i===idx?v:null),borderColor:'purple',pointRadius:6,type:'scatter',showLine:false},{label:'Rho Current',data:rhos.map((v,i)=>i===idx?v:null),borderColor:'red',pointRadius:6,type:'scatter',showLine:false}]},"options":{responsive:true,plugins:{legend:{position:'top'}},scales:{x:{title:{display:true,text:'Stock Price'}},y:{title:{display:true,text:'Greek Value'}}}}});}

['S','K','T','sigma','r','q','type','exercise'].forEach(id=>{
    document.getElementById(id).addEventListener('input',()=>{ updateStockSlicer(); updateChart(); });
});

document.getElementById('resetBtn').addEventListener('click',()=>{
    document.getElementById('S').value=100;
    document.getElementById('K').value=100;
    document.getElementById('T').value=1;
    document.getElementById('sigma').value=0.2;
    document.getElementById('r').value=0.05;
    document.getElementById('q').value=0;
    document.getElementById('type').value='call';
    document.getElementById('exercise').value='european';
    updateStockSlicer();
    updateChart();
});

updateStockSlicer();
updateChart();
</script>
  <footer style="margin:40px auto 20px;max-width:920px;text-align:center;font-size:12px;color:#777;font-style:italic;">
    © Quantik.org. All rights reserved. This model, including its code and associated intellectual property, is the exclusive property of Quantik.org and may not be copied, distributed, or replicated without prior written consent. Use of this calculator implies acceptance of these terms.
  </footer>
</body>
</html>
